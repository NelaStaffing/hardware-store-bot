{"ast":null,"code":"import React from'react';// Basic markdown to HTML (bold, italic, line breaks, lists)\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function formatMarkdown(text){if(!text)return'';let html=text.replace(/\\*\\*(.*?)\\*\\*/g,'<b>$1</b>')// bold\n.replace(/\\*(.*?)\\*/g,'<i>$1</i>')// italic\n.replace(/\\n/g,'<br />')// line breaks\n.replace(/\\r/g,'').replace(/\\n\\s*\\d+\\./g,'<br /><b>$&</b>')// numbered list\n.replace(/\\n\\s*-/g,'<br />•');// bullet list\nreturn html;}function stripHtml(html){const tmp=document.createElement('div');tmp.innerHTML=html;return tmp.textContent||tmp.innerText||'';}export default function ChatBubble(_ref){let{message,onProductClick}=_ref;const isAgent=message.sender==='agent';// Try to extract a JSON product_list block from the message\nlet text=stripHtml(message.text||'');let productList=null,intro='',outro='';if(isAgent&&text.includes('\"type\":\"product_list\"')){try{// Use regex to extract the JSON block for product_list\nconst match=text.match(/({[\\s\\S]*?\"type\"\\s*:\\s*\"product_list\"[\\s\\S]*})/m);if(match){let jsonStr=match[1];// Log the raw matched string before sanitization\nconsole.log('Matched JSON string:',jsonStr);// Attempt to repair common issues\njsonStr=jsonStr.replace(/,(\\s*[}\\]])/g,'$1')// Remove trailing commas\n.replace(/'/g,'\"')// Replace single with double quotes\n.replace(/&quot;/g,'\"');// Replace HTML entity quotes\n// Log for debugging\nconsole.log('Sanitized JSON string:',jsonStr);productList=JSON.parse(jsonStr);intro=text.slice(0,match.index).trim();outro=text.slice(match.index+match[1].length).trim();console.log('REGEX Parsed productList:',productList);}else{productList=null;console.error('No product_list JSON found.');}}catch(e){productList=null;console.error('REGEX JSON parse error:',e);}}return/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',flexDirection:isAgent?'row':'row-reverse',alignItems:'flex-end',gap:12},children:/*#__PURE__*/_jsxs(\"div\",{style:{background:isAgent?'#f3f4f6':'#d1eaff',color:'#222',borderRadius:14,padding:'10px 16px',maxWidth:480,fontSize:16,boxShadow:isAgent?'0 1px 4px #0001':'0 2px 8px #6cf2',wordBreak:'break-word',whiteSpace:'pre-line'},children:[isAgent&&productList?/*#__PURE__*/_jsxs(_Fragment,{children:[intro&&/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:10},dangerouslySetInnerHTML:{__html:formatMarkdown(intro)}}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',flexDirection:'column',gap:12,margin:'12px 0'},children:productList.products.map((p,i)=>/*#__PURE__*/_jsxs(\"div\",{style:{background:'#fff',borderRadius:10,boxShadow:'0 1px 4px #0001',padding:12,display:'flex',flexDirection:'column',gap:4,cursor:'pointer'},onClick:()=>onProductClick&&onProductClick(p.SKU),tabIndex:0,onKeyDown:e=>{if(e.key==='Enter'||e.key===' ')onProductClick&&onProductClick(p.SKU);},\"aria-label\":\"Preview \".concat(p.name),role:\"button\",children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:600,fontSize:16},children:p.name}),/*#__PURE__*/_jsxs(\"div\",{style:{color:'#388e3c',fontWeight:500},children:[\"$\",p.price]}),/*#__PURE__*/_jsxs(\"div\",{style:{color:'#888',fontSize:13},children:[\"SKU: \",p.SKU]}),p.aisle&&/*#__PURE__*/_jsxs(\"div\",{style:{color:'#1976d2',fontSize:13},children:[\"Aisle: \",p.aisle]})]},i))}),outro&&/*#__PURE__*/_jsx(\"div\",{style:{marginTop:10},dangerouslySetInnerHTML:{__html:formatMarkdown(outro)}})]}):isAgent?/*#__PURE__*/_jsx(\"span\",{dangerouslySetInnerHTML:{__html:formatMarkdown(text)}}):text,/*#__PURE__*/_jsx(\"div\",{style:{fontSize:11,color:'#888',marginTop:4,textAlign:isAgent?'left':'right'},children:message.timestamp})]})});}","map":{"version":3,"names":["React","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","formatMarkdown","text","html","replace","stripHtml","tmp","document","createElement","innerHTML","textContent","innerText","ChatBubble","_ref","message","onProductClick","isAgent","sender","productList","intro","outro","includes","match","jsonStr","console","log","JSON","parse","slice","index","trim","length","error","e","style","display","flexDirection","alignItems","gap","children","background","color","borderRadius","padding","maxWidth","fontSize","boxShadow","wordBreak","whiteSpace","marginBottom","dangerouslySetInnerHTML","__html","margin","products","map","p","i","cursor","onClick","SKU","tabIndex","onKeyDown","key","concat","name","role","fontWeight","price","aisle","marginTop","textAlign","timestamp"],"sources":["C:/Users/nelav/OneDrive/Desktop/Code Projects/hardware Store Bot/frontend/src/components/ChatBubble.js"],"sourcesContent":["import React from 'react';\n\n// Basic markdown to HTML (bold, italic, line breaks, lists)\nfunction formatMarkdown(text) {\n  if (!text) return '';\n  let html = text\n    .replace(/\\*\\*(.*?)\\*\\*/g, '<b>$1</b>') // bold\n    .replace(/\\*(.*?)\\*/g, '<i>$1</i>') // italic\n    .replace(/\\n/g, '<br />') // line breaks\n    .replace(/\\r/g, '')\n    .replace(/\\n\\s*\\d+\\./g, '<br /><b>$&</b>') // numbered list\n    .replace(/\\n\\s*-/g, '<br />•'); // bullet list\n  return html;\n}\n\nfunction stripHtml(html) {\n  const tmp = document.createElement('div');\n  tmp.innerHTML = html;\n  return tmp.textContent || tmp.innerText || '';\n}\n\nexport default function ChatBubble({ message, onProductClick }) {\n  const isAgent = message.sender === 'agent';\n\n  // Try to extract a JSON product_list block from the message\n  let text = stripHtml(message.text || '');\n  let productList = null, intro = '', outro = '';\n  if (isAgent && text.includes('\"type\":\"product_list\"')) {\n    try {\n      // Use regex to extract the JSON block for product_list\n      const match = text.match(/({[\\s\\S]*?\"type\"\\s*:\\s*\"product_list\"[\\s\\S]*})/m);\n      if (match) {\n        let jsonStr = match[1];\n        // Log the raw matched string before sanitization\n        console.log('Matched JSON string:', jsonStr);\n        // Attempt to repair common issues\n        jsonStr = jsonStr\n          .replace(/,(\\s*[}\\]])/g, '$1') // Remove trailing commas\n          .replace(/'/g, '\"') // Replace single with double quotes\n          .replace(/&quot;/g, '\"'); // Replace HTML entity quotes\n        // Log for debugging\n        console.log('Sanitized JSON string:', jsonStr);\n        productList = JSON.parse(jsonStr);\n        intro = text.slice(0, match.index).trim();\n        outro = text.slice(match.index + match[1].length).trim();\n        console.log('REGEX Parsed productList:', productList);\n      } else {\n        productList = null;\n        console.error('No product_list JSON found.');\n      }\n    } catch (e) {\n      productList = null;\n      console.error('REGEX JSON parse error:', e);\n    }\n  }\n\n  return (\n    <div style={{ display: 'flex', flexDirection: isAgent ? 'row' : 'row-reverse', alignItems: 'flex-end', gap: 12 }}>\n      <div style={{\n        background: isAgent ? '#f3f4f6' : '#d1eaff',\n        color: '#222',\n        borderRadius: 14,\n        padding: '10px 16px',\n        maxWidth: 480,\n        fontSize: 16,\n        boxShadow: isAgent ? '0 1px 4px #0001' : '0 2px 8px #6cf2',\n        wordBreak: 'break-word',\n        whiteSpace: 'pre-line',\n      }}>\n        {isAgent && productList ? (\n          <>\n            {intro && <div style={{ marginBottom: 10 }} dangerouslySetInnerHTML={{ __html: formatMarkdown(intro) }} />}\n            <div style={{ display: 'flex', flexDirection: 'column', gap: 12, margin: '12px 0' }}>\n              {productList.products.map((p, i) => (\n                <div\n                  key={i}\n                  style={{ background: '#fff', borderRadius: 10, boxShadow: '0 1px 4px #0001', padding: 12, display: 'flex', flexDirection: 'column', gap: 4, cursor: 'pointer' }}\n                  onClick={() => onProductClick && onProductClick(p.SKU)}\n                  tabIndex={0}\n                  onKeyDown={e => { if (e.key === 'Enter' || e.key === ' ') onProductClick && onProductClick(p.SKU); }}\n                  aria-label={`Preview ${p.name}`}\n                  role=\"button\"\n                >\n                  <div style={{ fontWeight: 600, fontSize: 16 }}>{p.name}</div>\n                  <div style={{ color: '#388e3c', fontWeight: 500 }}>${p.price}</div>\n                  <div style={{ color: '#888', fontSize: 13 }}>SKU: {p.SKU}</div>\n                  {p.aisle && <div style={{ color: '#1976d2', fontSize: 13 }}>Aisle: {p.aisle}</div>}\n                </div>\n              ))}\n            </div>\n            {outro && <div style={{ marginTop: 10 }} dangerouslySetInnerHTML={{ __html: formatMarkdown(outro) }} />}\n          </>\n        ) : isAgent ? (\n          <span dangerouslySetInnerHTML={{ __html: formatMarkdown(text) }} />\n        ) : (\n          text\n        )}\n        <div style={{ fontSize: 11, color: '#888', marginTop: 4, textAlign: isAgent ? 'left' : 'right' }}>{message.timestamp}</div>\n      </div>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}